pipeline {
    agent any
    tools {
        terraform 'TF'
    }
String credentialsId = 'awsCredentials'

    stages {
        stage ('get TF file') {
            steps {
                sh  '''cd /home/azamat/FinalProject \
                && wget https://raw.githubusercontent.com/azamated/devops-school-exercises/master/Final%20Project/Terraform/main.tf '''
            }
        }

        stage ('Terraform init and Apply') {
            steps {
                withCredentials([[$class: 'AmazonWebServicesCredentialsBinding', credentialsId: credentialsId, ACCESS_KEY: 'ACCESS_KEY', SECRET_KEY: 'SECRET_KEY']]) {
                sh  '''cd /home/azamat/FinalProject && terraform init \
                terraform plan && terraform apply -input=false -auto-approve '''
                }
            }

        }
    }

}



