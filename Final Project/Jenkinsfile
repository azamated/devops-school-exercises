pipeline {

    parameters {
        password (name: 'AWS_ACCESS_KEY_ID')
        password (name: 'AWS_SECRET_ACCESS_KEY')
    }

    environment {
        TF_WORKSPACE = 'dev' //Sets the Terraform Workspace
        TF_IN_AUTOMATION = 'true'
        AWS_ACCESS_KEY_ID = "${params.AWS_ACCESS_KEY_ID}"
        AWS_SECRET_ACCESS_KEY = "${params.AWS_SECRET_ACCESS_KEY}"
    }

    agent any

    tools {
        terraform 'TF'
    }

    stages {
            stage ('get TF file') {
                steps   {
                    sh  '''cd /home/azamat/FinalProject \
                    && wget https://raw.githubusercontent.com/azamated/devops-school-exercises/master/Final%20Project/Terraform/main.tf '''
                }

            stage ('Terraform init and Apply') {
                steps   {
                    sh  '''cd /home/azamat/FinalProject && terraform init -input=false \
                    terraform plan && terraform apply -input=false -auto-approve '''
                }

            }
    }

}



